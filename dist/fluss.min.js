!function t(e,n,r){function o(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=n[s]={exports:{}};e[s][0].call(h.exports,function(t){var n=e[s][1][t];return o(n?n:t)},h,h.exports,t,e,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,n){"use strict";function r(t){for(var e=[],n=0;n<arguments.length-1;n++)e[n]=arguments[n+1];i.getDispatcher().dispatchAction.apply(i.getDispatcher(),[t].concat(e))}function o(){i.getDispatcher().dispatchAction(1)}var i=t("./dispatcher");!function(t){t[t.__ANY__=0]="__ANY__",t[t.UNDO=1]="UNDO"}(n.ACTIONS||(n.ACTIONS={}));n.ACTIONS;n.firstAction=1e3,n.triggerAction=r,n.undo=o},{"./dispatcher":void 0}],2:[function(t,e,n){"use strict";function r(t,e){return{action:-1,data:e,redo:null,undo:null,instance:t}}function o(t,e){return{action:t,data:e}}function i(t){for(var e=[],n=0;n<arguments.length-1;n++)e[n]=arguments[n+1];return{action:-1,data:null,redo:null,undo:{action:t,data:e},instance:null}}function s(){return v}function a(t){for(var e=[],n=0;n<arguments.length-1;n++)e[n]=arguments[n+1];v.dispatchAction.apply(v,[t].concat(e))}function u(t,e,n){v.subscribeAction(t,e,n)}function c(t,e){v.unsubscribeAction(t,e)}function h(t){v.disableAction(t)}function p(t){v.enableAction(t)}function f(){v.destroy(),v=new y}function l(){return S}{var d=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},m=t("./errors"),_=t("./eventChannel");t("./baseActions")}n.createMemento=r,n.createRedo=o,n.createUndoAction=i,function(t){t[t.UNDO=0]="UNDO",t[t.REDO=1]="REDO",t[t.MEMENTO_STORED=2]="MEMENTO_STORED",t[t.CLEAR=3]="CLEAR"}(n.EVENTS||(n.EVENTS={}));var g=(n.EVENTS,0),y=function(){function t(){this._handlers={},this._dispatching=!1,this._undoing=!1,this._disabled={}}return t.prototype.destroy=function(){this._handlers={},this._dispatching=!1,this._undoing=!1,this._disabled={}},Object.defineProperty(t.prototype,"undoing",{get:function(){return this._undoing},enumerable:!0,configurable:!0}),t.prototype.dispatch=function(t,e,r){try{var o=[],i=this,s=function(e,n,s){i._handlers[e]&&i._handlers[e].forEach(function(a){if(t&&a[1]){var u=a[1].apply(i,[s||e].concat(r));u&&("[object Array]"===Object.prototype.toString.call(u)?Array.prototype.push.apply(o,u):o.push(u))}n(a[0],r)})};s(e,function(t,e){t.apply(this,e)}),s(g,function(t,n){t.apply(this,[e,n])},e),o.length&&n.getUndoManager().storeMementos(o,e,n.createRedo(e,r))}catch(a){var u="Internal error. If this happens please check if it was a user error \nthat can be either prevented or gracefully handled.\n\n";u+="Handled action: "+e+"\n",u+="Create memento: "+(t?"yes\n":"no\n");var c="";try{c=JSON.stringify(r,null,2)}catch(a){c="It's a circular structure :-("}u+="Arguments     : "+c+"\n",u+="Mementos      : "+(o?JSON.stringify(o,null,2):"none")+"\n",u+="Exception     : "+a.message+"\n",u+="Stack trace   :\n"+a.stack+"\n",console.log(u),m.framework(a.message,a,i)}},t.prototype.dispatchUndoAction=function(t){for(var e=[],n=0;n<arguments.length-1;n++)e[n]=arguments[n+1];if(!this._disabled[t]){this._undoing=!0;try{this.dispatch(!1,t,e)}finally{this._undoing=!1}}},t.prototype.dispatchAction=function(t){for(var e=[],n=0;n<arguments.length-1;n++)e[n]=arguments[n+1];this._disabled[t]||this.dispatch(!0,t,e)},t.prototype.subscribeAction=function(t,e,n){this._handlers[t]||(this._handlers[t]=[]),-1===this._handlers[t].indexOf(e)&&this._handlers[t].push([e,n])},t.prototype.unsubscribeAction=function(t,e){if(this._handlers[t])for(var n=0;n<this._handlers[t].length;n++)if(this._handlers[t][n][0]===e)return void this._handlers[t].splice(n,1)},t.prototype.disableAction=function(t){this._disabled[t]=!0},t.prototype.enableAction=function(t){this._disabled[t]&&delete this._disabled[t]},t}(),v=new y;n.getDispatcher=s,n.dispatch=a,n.subscribeAction=u,n.unsubscribeAction=c,n.disableAction=h,n.enableAction=p,n.reset=f;var b=function(t){function e(){t.call(this,"UndoManager"),this.clear(),n.getDispatcher().subscribeAction(1,this.undo.bind(this))}return d(e,t),e.prototype.storeMementos=function(t,e,n){t&&(t.forEach(function(t){t&&(t.redo=n,t.action=e)}),this.mementos.push(t),this.redos=[],this.emit(2,t))},e.prototype.undo=function(){var t=this.mementos.pop();if(t){var e=[];t.forEach(function(t,r){t.undo?n.getDispatcher().dispatchUndoAction.apply(n.getDispatcher(),[t.undo.action].concat(t.undo.data)):t.instance.restoreFromMemento(t),r||e.push(t.redo)}),this.redos.push(e),this.emit(0,t)}},e.prototype.redo=function(){var t=this.redos.pop();t&&(t.forEach(function(t){n.getDispatcher().dispatchAction.apply(n.getDispatcher(),[t.action].concat(t.data))}),this.emit(1,t))},e.prototype.clear=function(){this.mementos=[],this.redos=[],this.emit(3)},e.prototype.getMementos=function(){return this.mementos},e}(_.ChanneledEmitter),S=new b;n.getUndoManager=l},{"./baseActions":void 0,"./errors":void 0,"./eventChannel":void 0}],3:[function(t,e,n){"use strict";var r=function(){function t(){}return t.prototype.subscribe=function(t,e){this._eventHandlers||(this._eventHandlers={}),this._eventHandlers[t]||(this._eventHandlers[t]=[]),this._eventHandlers[t].push(e)},t.prototype.unsubscribe=function(t,e){this._eventHandlers&&this._eventHandlers[t]&&this._eventHandlers[t].splice(this._eventHandlers[t].indexOf(e),1)},Object.defineProperty(t.prototype,"eventHandlers",{get:function(){return this._eventHandlers},enumerable:!0,configurable:!0}),t.prototype.emit=function(t){for(var e=[],n=0;n<arguments.length-1;n++)e[n]=arguments[n+1];var r=this;this._eventHandlers&&this._eventHandlers[t]&&this._eventHandlers[t].forEach(function(t){t.apply(r,e)})},t.prototype.relay=function(t,e,n){var r=this;t.subscribe(e,function(){for(var t=[],e=0;e<arguments.length-0;e++)t[e]=arguments[e+0];r.emit.apply(r,[n].concat(t))})},t}();n.Emitter=r},{}],4:[function(t,e,n){"use strict";function r(){return h}function o(t,e){return h.error(t,e)}function i(t,e){return h.fatal(t,e)}function s(t,e,n){return h.framework(t,e,n)}var a=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},u=t("./eventChannel");!function(t){t[t.ERROR=0]="ERROR",t[t.FATAL=1]="FATAL",t[t.FRAMEWORK=2]="FRAMEWORK",t[t.CLEAR=3]="CLEAR"}(n.EVENTS||(n.EVENTS={}));var c=(n.EVENTS,function(t){function e(){t.call(this,"ERROR")}return a(e,t),e.prototype.error=function(t,e){this.emit(0,t,e)},e.prototype.fatal=function(t,e){this.emit(1,t,e)},e.prototype.framework=function(t,e){throw e},e}(u.ChanneledEmitter)),h=new c;n.getErrorHandler=r,n.error=o,n.fatal=i,n.framework=s},{"./eventChannel":void 0}],5:[function(t,e,n){"use strict";function r(){return l}function o(t,e,n){l.subscribe(t,e,n)}function i(t,e,n){l.unsubscribe(t,e,n)}function s(t,e){for(var n=[],r=0;r<arguments.length-2;r++)n[r]=arguments[r+2];l.channelEmit(null,t,e,n)}function a(t){l.unsubscribeAll(t)}function u(t){for(var e=[],n=0;n<arguments.length-1;n++)e[n]=arguments[n+1];var r=null;return e.forEach(function(e){var n=new _(t+"-"+e,t,e);r=r?r.combine(n):n}),r}var c=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},h=t("./emitter"),p=t("./stream"),f=function(){function t(){this._eventHandlers={}}return t.prototype.subscribe=function(t,e,n){this._eventHandlers[t]||(this._eventHandlers[t]={}),this._eventHandlers[t][e]||(this._eventHandlers[t][e]=[]),this._eventHandlers[t][e].push(n)},t.prototype.unsubscribe=function(t,e,n){this._eventHandlers[t]&&this._eventHandlers[t][e]&&this._eventHandlers[t][e].splice(this._eventHandlers[t][e].indexOf(n),1)},t.prototype.channelEmit=function(t,e,n,r){this._eventHandlers&&this._eventHandlers[e]&&this._eventHandlers[e][n]&&this._eventHandlers[e][n].forEach(function(e){e.apply(t,r)})},t.prototype.unsubscribeAll=function(t){delete this._eventHandlers[t]},t}(),l=new f;n.getChannel=r,n.subscribe=o,n.unsubscribe=i,n.channelEmit=s,n.unsubscribeAll=a;var d=[],m=function(t){function e(e){if(t.call(this),this.emitterID=e,-1!==d.indexOf(e))throw new Error("Duplicate emitterID. This is not supported")}return c(e,t),e.prototype.subscribe=function(e,n){t.prototype.subscribe.call(this,e,n)},e.prototype.emit=function(t){for(var e=[],n=0;n<arguments.length-1;n++)e[n]=arguments[n+1];var r=this;this.eventHandlers&&this.eventHandlers[t]&&this.eventHandlers[t].forEach(function(t){t.apply(r,e)}),l.channelEmit(this,this.emitterID,t,e)},e}(h.Emitter);n.ChanneledEmitter=m;var _=function(t){function e(e,r,o){t.call(this,e),this._emitterID=r,this._event=o,this._handler=this.handleEvent.bind(this),n.subscribe(this._emitterID,o,this._handler)}return c(e,t),e.prototype.handleEvent=function(){for(var t=[],e=0;e<arguments.length-0;e++)t[e]=arguments[e+0];this.push({emitter:this._emitterID,event:this._event,args:t})},e.prototype.dispose=function(){t.prototype.dispose.call(this),n.unsubscribe(this._emitterID,this._event,this._handler)},e}(p.Stream);n.createEventStream=u},{"./emitter":void 0,"./stream":void 0}],6:[function(){"use strict"},{}],7:[function(t,e,n){"use strict";var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},o=t("./dispatcher"),i=t("./eventChannel"),s=(t("./baseActions"),function(){function t(){}return t.prototype.run=function(){for(var t=[],e=0;e<arguments.length-2;e++)t[e]=arguments[e+2]},t.prototype.afterFinish=function(){for(var t=[],e=0;e<arguments.length-2;e++)t[e]=arguments[e+2]},t.prototype.afterAbort=function(){for(var t=[],e=0;e<arguments.length-2;e++)t[e]=arguments[e+2]},t.prototype.getMemento=function(){for(var t=[],e=0;e<arguments.length-2;e++)t[e]=arguments[e+2];return null},t.prototype.restoreFromMemento=function(){},t.prototype.hold=function(){},t.prototype.release=function(){},t.prototype.abort=function(){},t}());n.BasePlugin=s;var a=function(t){function e(e){t.call(this,e),this._plugins={},this._anyPlugins=[],this._protocols={},this._runningPlugins={},this._mementos={}}return r(e,t),e.prototype.configure=function(t){function e(t,e){function n(){t.apply(this,e)}return n.prototype=t.prototype,new n}var n=this;t.forEach(function(t){t.plugins.forEach(function(r){r.plugin?n.wrap(t.action,e(r.plugin,r.parameters)):n.wrap(t.action,new r)})})},e.prototype.destroy=function(){for(var t in this._plugins)if(this._plugins.hasOwnProperty(t))for(var e=this._plugins[t].length;e--;)this.detach(t,this._plugins[t][e]);this._anyPlugins=[],this._runningPlugins={}},e.prototype.pluginDone=function(){},e.prototype.abortAction=function(t){if(this._runningPlugins[t]&&this._runningPlugins[t].length){var e=this._runningPlugins[t][this._runningPlugins[t].length-1];e&&e.abort(t)}this._runningPlugins[t]=null},e.prototype.abort=function(t){if("undefined"==typeof t)for(var e in this._protocols)this._protocols.hasOwnProperty(e)&&this.abortAction(e);else this._protocols[t]&&this.abortAction(t)},e.prototype.doHandleAction=function(t,e,n){if(this._runningPlugins[e]&&this._runningPlugins[e].length)throw new Error("ERROR calling action "+e+". Same action cannot be called inside itself!");var r=this,o=function(t,e){return[r,e].concat(n)};this._mementos[e]=[],this._runningPlugins[e]=[],this._protocols[e]=[],t.forEach(function(t){r._protocols[e].push(0),r._runningPlugins[e].push(t)});var i=!1;t.forEach(function(t,s){!function(s){var a=function(e,i){s=r.getPluginsForAction(i).indexOf(t),r._protocols[i][s]={plugin:t,done:function(e){e?t.afterAbort.apply(t,o(t,i)):t.afterFinish.apply(t,o(t,i))},abort:e};for(var a=r._protocols[i].length;a--&&r._protocols[i][a];)e|=r._protocols[i][a].abort,r._protocols[i][a].done(e),r._protocols[i].pop(),r._runningPlugins[i]&&r._runningPlugins[i].pop();r._runningPlugins[i]&&r._runningPlugins[i].length||r.finalizeAction(i,e,r.getPluginsForAction(i),r._mementos[i],n)},u=!1,c={};if(t.hold=function(){u=!0},t.abort=function(t){var n="undefined"==typeof t?e:t;c[n]=!0,a(!0,n),i=!0},t.release=function(t){var n="undefined"==typeof t?e:t;if(c[n])throw new Error("Plugin released twice for action "+n+"! Possibly called release after abort or vice versa.");a(!1,n),c[n]=!0},!i){var h=t.getMemento.apply(t,o(t,e));if(h&&(h.instance={restoreFromMemento:function(e){t.restoreFromMemento(r,e)}},r._mementos[e].push(h)),t.run.apply(t,o(t,e)),i){for(var p=r._protocols[e]&&r._protocols[e].length||0;p--;)r._protocols[e][p]&&(r._protocols[e][p].done(!0),r._protocols[e].pop());r.finalizeAction(e,!0,r.getPluginsForAction(e),null,n)}else u||c[e]||a(!1,e)}}(s)})},e.prototype.getPluginsForAction=function(t){return this._plugins[t]&&this._plugins[t].length?this._plugins[t]:this._anyPlugins&&this._anyPlugins.length?this._anyPlugins:[]},e.prototype.handleAction=function(t,e){try{this.doHandleAction(this.getPluginsForAction(t),t,e)}catch(n){throw this.abort(),n}},e.prototype.finalizeAction=function(t,e,n,r,i){e||r&&r.length&&!o.getDispatcher().undoing&&o.getUndoManager().storeMementos(r,t,o.createRedo(t,i)),this._mementos[t]=null,this._runningPlugins[t]=null,this._protocols[t]=null},e.prototype.provideMementos=function(t,e,n){if(e){var r=[],i=this;e.forEach(function(e){var o=e.getMemento.apply(e,[i,t].concat(n));o&&(o.instance={restoreFromMemento:function(t){e.restoreFromMemento(i,t)}},r.push(o))}),r.length&&o.getUndoManager().storeMementos(r,t,o.createRedo(t,n))}return null},e.prototype.wrap=function(t,e){if(0===t){if(0===this._anyPlugins.length){var n=this;o.subscribeAction(0,function(){for(var t=[],e=0;e<arguments.length-0;e++)t[e]=arguments[e+0];var r=t.shift();n._plugins[r]||n.handleAction(r,t)},function(){for(var t=[],e=0;e<arguments.length-1;e++)t[e]=arguments[e+1];return null})}for(var r in this._plugins)this._plugins.hasOwnProperty(r)&&this.doWrap(r,e);this._anyPlugins.unshift(e)}else{if(!this._plugins[t]&&this._anyPlugins.length)for(var i=this._anyPlugins.length;i--;)this.doWrap(t,this._anyPlugins[i]);this.doWrap(t,e)}},e.prototype.doWrap=function(t,e){if(!this._plugins[t]){this._plugins[t]=[];var n=this;o.subscribeAction(t,function(){for(var e=[],r=0;r<arguments.length-0;r++)e[r]=arguments[r+0];n.handleAction(t,e)},function(){for(var t=[],e=0;e<arguments.length-1;e++)t[e]=arguments[e+1];return null})}if(-1!==this._plugins[t].indexOf(e))throw new Error("Plugin instances can only be used once per action!");this._plugins[t].unshift(e)},e.prototype.detach=function(t,e){if(0===t){this._anyPlugins.splice(this._anyPlugins.indexOf(e),1);for(var n in this._plugins)this._plugins.hasOwnProperty(n)&&this._plugins[n].splice(this._plugins[n].indexOf(e),1)}else this._plugins[t]&&this._plugins[t].splice(this._plugins[t].indexOf(e),1)},e}(i.ChanneledEmitter);n.PluginContainer=a},{"./baseActions":void 0,"./dispatcher":void 0,"./eventChannel":void 0}],8:[function(t,e,n){"use strict";function r(t){return t instanceof l||t instanceof m||t instanceof d||t instanceof _}function o(t,e,n,r){var o={item:t,value:e,store:n};return r&&(o.path=r),o}function i(t){function e(t){var e;return e="object"==typeof t?c.isArray(t)?n(t):r(t):t}function n(t){var n=new m;return t.forEach(function(t){n.push(e(t))}),n}function r(t){var n=new l;for(var r in t)t.hasOwnProperty(r)&&n.addItem(r,e(t[r]));return n}return"object"==typeof t?c.isArray(t)?n(t):r(t):null}function s(t){return t?i(t):new l}function a(t){return t?i(t):new m}var u=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},c=t("./tools"),h=t("./stream");n.isStore=r;var p=function(){function t(){this._addItemsStreams=[],this._removeItemsStreams=[],this._updateStreams=[],this._disposingStreams=[]}return Object.defineProperty(t.prototype,"isImmutable",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.removeStream=function(t,e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)},t.prototype.newItems=function(){var t=this,e=h.createStream("addProperty");return this._addItemsStreams.push(e),e.onClose(function(){t.removeStream(t._addItemsStreams,e)}),e},t.prototype.removedItems=function(){var t=this,e=h.createStream("removeProperty");return this._removeItemsStreams.push(e),e.onClose(function(){t.removeStream(t._removeItemsStreams,e)}),e},t.prototype.updates=function(){var t=this,e=h.createStream("updateProperty");return this._updateStreams.push(e),e.onClose(function(){t.removeStream(t._updateStreams,e)}),e},Object.defineProperty(t.prototype,"immutable",{get:function(){return null},enumerable:!0,configurable:!0}),t.prototype.disposing=function(){var t=this,e=h.createStream("disposing");return this._disposingStreams.push(e),e.onClose(function(){t.removeStream(t._disposingStreams,e)}),e},t.prototype.disposeStreams=function(t){t.forEach(function(t){t.dispose()})},t.prototype.dispose=function(){this._disposingStreams.forEach(function(t){t.push(!0)}),this.disposeStreams(this._disposingStreams),this.disposeStreams(this._updateStreams),this.disposeStreams(this._addItemsStreams),this.disposeStreams(this._removeItemsStreams)},t}(),f=function(t){function e(){t.apply(this,arguments)}return u(e,t),e}(p),l=function(t){function e(e){if(t.call(this),this._data={},this._subStreams={},e)for(var n in e)e.hasOwnProperty(n)&&this.addItem(n,e[n])}return u(e,t),e.prototype.checkNameAllowed=function(){return!0},e.prototype.setupSubStream=function(t,e){if(this.disposeSubStream(t),n.isStore(e)){var r,i=this;r=e.updates(),r.forEach(function(e){var n=o(e.item,e.value,e.store,e.path?t+"."+e.path:t+"."+e.item);i._updateStreams.forEach(function(t){t.push(n)})}),this._subStreams[t]=r}},e.prototype.disposeSubStream=function(t){var e=this._subStreams[t];e&&e.dispose()},e.prototype.addItem=function(t,e){if(!this.checkNameAllowed(t))throw new Error("Name '"+t+"' not allowed for property of object store.");var n=this;Object.defineProperty(this,t,{configurable:!0,get:function(){return n._data[t]},set:function(e){n._data[t]=e;var r=o(t,e,n);n.setupSubStream(t,e),n._updateStreams.forEach(function(t){t.push(r)})}}),this._data[t]=e,this.setupSubStream(t,e),this._addItemsStreams&&this._addItemsStreams.forEach(function(r){r.push(o(t,e,n))})},e.prototype.removeItem=function(t){if(!this._data.hasOwnProperty(t))throw new Error("Unknown property '"+t+"'.");delete this[t],delete this._data[t];var e=this;this.disposeSubStream(t),this._removeItemsStreams.forEach(function(n){n.push(o(t,null,e))})},Object.defineProperty(e.prototype,"immutable",{get:function(){return this._immutable||(this._immutable=new d(this)),this._immutable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keys",{get:function(){var t=[];for(var e in this._data)t.push(e);return t},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;this.keys.forEach(function(t){n.isStore(e[t])&&e[t].dispose(),delete e[t]}),this._data=null,t.prototype.dispose.call(this)},e}(p),d=function(t){function e(e){t.call(this),this._parent=e;var n=this;e.keys.forEach(function(t){n.addItem(t)}),e.newItems().forEach(function(t){n.addItem(t.item)}).until(e.disposing()),e.removedItems().forEach(function(t){n.removeItem(t.item)}).until(e.disposing())}return u(e,t),Object.defineProperty(e.prototype,"isImmutable",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"immutable",{get:function(){return this},enumerable:!0,configurable:!0}),e.prototype.addItem=function(t){var e=this;Object.defineProperty(this,t,{configurable:!0,get:function(){return n.isStore(e._parent[t])?e._parent[t].immutable:e._parent[t]},set:function(){}})},e.prototype.removeItem=function(t){delete this[t]},Object.defineProperty(e.prototype,"keys",{get:function(){return this._parent.keys},enumerable:!0,configurable:!0}),e.prototype.subscribeParentStream=function(t){var e=h.createStream();t.forEach(function(t){e.push(t)}).until(this._parent.disposing());var n=this;return this._updateStreams.push(e),e.onClose(function(){n.removeStream(n._updateStreams,e)}),e},e.prototype.updates=function(){return this.subscribeParentStream(this._parent.updates())},e.prototype.newItems=function(){return this.subscribeParentStream(this._parent.newItems())},e.prototype.removedItems=function(){return this.subscribeParentStream(this._parent.removedItems())},e.prototype.disposing=function(){return this.subscribeParentStream(this._parent.disposing())},e}(f);n.record=s;var m=function(t){function e(e){t.call(this),this._data=e||[],this._maxProps=0,this.updateProperties(),this._substreams={}}return u(e,t),e.prototype.toString=function(){return this._data.toString()},e.prototype.toLocaleString=function(){return this._data.toLocaleString()},e.prototype.forEach=function(t,e){this._data.forEach(t,e)},e.prototype.every=function(t,e){return this._data.every(t,e)},e.prototype.some=function(t,e){return this._data.some(t,e)},e.prototype.indexOf=function(t){return this._data.indexOf(n.isStore(t)&&t.isImmutable?t._parent:t)},e.prototype.lastIndexOf=function(t,e){return this._data.lastIndexOf(t,e)},e.prototype.join=function(t){return this._data.join(t)},e.prototype.map=function(t,n){var r=this._data.map(t,n);return new e(r)},e.prototype.filter=function(t,n){var r=this._data.filter(t,n);return new e(r)},e.prototype.reduce=function(t,e){return this._data.reduce(t,e)},e.prototype.sort=function(t){var e=this._data.map(function(t){return t});e.sort(t);var n=this;e.forEach(function(t,e){t!==n._data[e]&&(n[e]=t)})},e.prototype.reverse=function(){var t=this._data.map(function(t){return t});t.reverse();var e=this;t.forEach(function(t,n){t!==e._data[n]&&(e[n]=t)})},e.prototype.concat=function(t){var n;return n=this._data.concat(t instanceof e?t._data:t),new e(n)},e.prototype.concatInplace=function(t){t instanceof e?this.splice.apply(this,[this.length,0].concat(t._data)):this.splice.apply(this,[this.length,0].concat(t))},Object.defineProperty(e.prototype,"length",{get:function(){return this._data.length},enumerable:!0,configurable:!0}),e.prototype.setupSubStreams=function(t,e){var r=this;if(n.isStore(e)){var i=this._substreams[c.oid(e)];i&&i.updates.dispose(),i={updates:e.updates()},i.updates.forEach(function(e){var n=o(e.item,e.value,r,e.path?t+"."+e.path:t+"."+e.item);r._updateStreams.forEach(function(t){t.push(n)})}),this._substreams[c.oid(e)]=i}},e.prototype.disposeSubstream=function(t){if(n.isStore(t)&&-1===this._data.indexOf(t)){var e=this._substreams[c.oid(t)];e&&(e.updates.dispose(),delete this._substreams[c.oid(t)])}},e.prototype.updateProperties=function(){var t,e=this;for(t=0;t<this._data.length;t++)e.setupSubStreams(t,this._data[t]);for(t=this._maxProps;t<this._data.length;t++)!function(t){Object.defineProperty(e,""+t,{configurable:!0,get:function(){return e._data[t]},set:function(n){var r=e._data[t];n!==r&&(e._data[t]=n,e.disposeSubstream(r),e.setupSubStreams(t,n),e._updateStreams.forEach(function(n){n.push(o(t,e._data[t],e))}))}})}(t);this._maxProps=this._data.length},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length-0;e++)t[e]=arguments[e+0];var n=this._data.length,r=this;t.forEach(function(t){r._data.push(t),r._addItemsStreams.forEach(function(t){t.push(o(n,r._data[n],r))}),n++}),this.updateProperties()},e.prototype.unshift=function(){for(var t=[],e=0;e<arguments.length-0;e++)t[e]=arguments[e+0];for(var n=this,r=t.length;r--;)!function(){this._data.unshift(t[0]),this._newItemStreams.forEach(function(t){t.push(o(0,n._data[0],n))})}();this.updateProperties()},e.prototype.pop=function(){var t=this._data.pop(),e=this;return this.disposeSubstream(t),this._removeItemsStreams.forEach(function(t){t.push(o(e._data.length,null,e))}),t},e.prototype.shift=function(){var t=this._data.shift(),e=this;return this.disposeSubstream(t),this._removeItemsStreams.forEach(function(t){t.push(o(0,null,e))}),t},e.prototype.splice=function(t,e){for(var n=[],r=0;r<arguments.length-2;r++)n[r]=arguments[r+2];var i=this._data.splice.apply(this._data,[t,e].concat(n)),s=t,a=this;if(a._removeItemsStreams.length&&i.forEach(function(t){a.disposeSubstream(t),a._removeItemsStreams.forEach(function(e){e.push(o(s,t,a))}),s++}),s=t,n.forEach(function(){a._addItemsStreams.forEach(function(t){t.push(o(s,a._data[s],a))}),s++}),e!==n.length)for(s;s<this._data.length;s++)a._updateStreams.forEach(function(t){t.push(o(s,a._data[s],a))});return this.updateProperties(),i},e.prototype.insert=function(t){for(var e=[],n=0;n<arguments.length-1;n++)e[n]=arguments[n+1];this.splice.apply(this,[t,0].concat(e))},e.prototype.remove=function(t,e){return"undefined"==typeof e&&(e=1),this.splice(t,e)},e.prototype.dispose=function(){for(var e=0;e<this.length;e++)n.isStore(this[e])&&this[e].dispose(),delete this[e];this._data=null,t.prototype.dispose.call(this)},Object.defineProperty(e.prototype,"immutable",{get:function(){return this._immutable||(this._immutable=new _(this)),this._immutable},enumerable:!0,configurable:!0}),e}(p),_=function(t){function e(e){t.call(this),this._parent=e;var n=this;e.newItems().forEach(function(){n.updateProperties()}).until(e.disposing()),this._maxProps=0,this.updateProperties()}return u(e,t),e.prototype.updateProperties=function(){var t,e=this;for(t=this._maxProps;t<this._parent.length;t++)!function(t){Object.defineProperty(e,""+t,{configurable:!0,get:function(){return n.isStore(e._parent[t])?e._parent[t].immutable:e._parent[t]},set:function(){}})}(t);this._maxProps=this._parent.length},e.prototype.toString=function(){return this._parent.toString()},e.prototype.toLocaleString=function(){return this._parent.toString()},e.prototype.forEach=function(t){return this._parent.forEach(t)},e.prototype.every=function(t){return this._parent.every(t)},e.prototype.some=function(t){return this._parent.forEach(t)},e.prototype.indexOf=function(t){return this._parent.indexOf(t)},e.prototype.lastIndexOf=function(t,e){return this._parent.lastIndexOf(t,e)},e.prototype.join=function(t){return this._parent.join(t)},e.prototype.map=function(t){return this._parent._data.map(t)},e.prototype.filter=function(t){return this._parent._data.filter(t)},e.prototype.reduce=function(t,e){return this._parent.reduce(t,e)},Object.defineProperty(e.prototype,"length",{get:function(){return this._parent.length},enumerable:!0,configurable:!0}),e.prototype.subscribeParentStream=function(t){var e=h.createStream();t.forEach(function(t){e.push(t)}).until(this._parent.disposing());var n=this;return this._updateStreams.push(e),e.onClose(function(){n.removeStream(n._updateStreams,e)}),e},e.prototype.updates=function(){return this.subscribeParentStream(this._parent.updates())},e.prototype.newItems=function(){return this.subscribeParentStream(this._parent.newItems())},e.prototype.removedItems=function(){return this.subscribeParentStream(this._parent.removedItems())},e.prototype.disposing=function(){return this.subscribeParentStream(this._parent.disposing())},Object.defineProperty(e.prototype,"immutable",{get:function(){return this},enumerable:!0,configurable:!0}),e}(f);n.array=a},{"./stream":void 0,"./tools":void 0}],9:[function(t,e,n){"use strict";function r(t){return new o(t||"stream")}var o=function(){function t(t){this._name=t,this._buffer=[],this._methods=[],this._errorMethods=[],this._closeMethods=[],this._closed=!1,this._length=0,this._maxLength=0}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),t.prototype.callCloseMethods=function(){var t=this;this._closeMethods.forEach(function(e){e.call(t)})},t.prototype.close=function(){this._closed||(this._closed=!0,this.callCloseMethods(),this.dispose())},t.prototype.dispose=function(){this.close(),this._methods=[],this._buffer=[],this._closeMethods=[],this._errorMethods=[]},t.prototype.times=function(t){return this._maxLength=t,this},t.prototype.until=function(t){var e=this;return t&&t.forEach(function(){e.close()}),this},Object.defineProperty(t.prototype,"closed",{get:function(){return this._closed},enumerable:!0,configurable:!0}),t.prototype.addToBuffer=function(t){this._buffer.unshift(t)},t.prototype.processBuffer=function(t,e,n){if(this._closed)return null;if(!e.length)return null;for(var r=t.length,o=this,i=[];r--;){var s=t.pop();e.forEach(function(t,e){try{t.call(o,s,e+n)}catch(r){i.push(r)}})}return i},t.prototype.processBuffers=function(){var t=this.processBuffer(this._buffer,this._methods,this._length-this._buffer.length);t&&t.length&&(this._errorMethods.length?this.processBuffer(t,this._errorMethods,0):t.forEach(function(t){throw t}))},t.prototype.addMethod=function(t){var e=0===this._methods.length;this._methods.push(t),e&&this.processBuffers()},t.prototype.addErrorMethod=function(t){this._errorMethods.push(t)},t.prototype.addCloseMethod=function(t){this.closed?t.call(this):this._closeMethods.push(t)},t.prototype.push=function(t){this._closed||(this.addToBuffer(t),this._length++,this.processBuffers(),this._length===this._maxLength&&this.close())},t.prototype.pushError=function(t){if(!this._errorMethods||!this._errorMethods.length)throw t;this.processBuffer([t],this._errorMethods,0)},t.prototype.forEach=function(t){return this.addMethod(t),this},t.prototype.addMethodToNextStream=function(t,e,n){var r=this;this.addMethod(function(n,o){try{e.call(r,n,o)}catch(i){t.pushError(i)}}),this.onClose(n?n:function(){t.close()})},t.prototype.filter=function(e){var n=new t(this._name+".filter"),r=this;return"function"==typeof e?this.addMethodToNextStream(n,function(t,o){e.call(r,t,o)&&n.push(t)}):this.addMethodToNextStream(n,function(t){e==t&&n.push(t)}),this._closed&&n.close(),n},t.prototype.map=function(e){var n=new t(this._name+".map"),r=this;return"function"==typeof e?this.addMethodToNextStream(n,function(t,o){n.push(e.call(r,t,o))}):this.addMethodToNextStream(n,function(){n.push(e)}),this._closed&&n.close(),n},t.prototype.scan=function(e,n){var r=new t(this._name+".scan"),o=this,i=n;return this.addMethodToNextStream(r,function(t){i=e.call(o,i,t),r.push(i)}),r.push(i),this._closed&&r.close(),r},t.prototype.reduce=function(e,n){var r=new t(this._name+".reduce"),o=this,i=n;return this.addMethodToNextStream(r,function(t){i=e.call(o,i,t)},function(){r.push(i),r.close()}),this._closed&&r.close(),r},t.prototype.concat=function(e){var n=new t(this._name+".concat"),r=null;return this._closed?e.closed&&n.close():r=[],e.forEach(function(t){r?r.push(t):n.push(t)}),e.onClose(function(){r||n.close()}),this.addMethodToNextStream(n,function(t){n.push(t)},function(){r&&r.forEach(function(t){n.push(t)}),e.closed&&n.close(),r=null}),this._closed&&e.closed&&n.close(),n},t.prototype.concatAll=function(){function e(){for(var t=i.length;t--;){if(s=i[t],n(),!s.done){n();break}i.pop()}}function n(){if(s)for(var t=s.data.length;t--;)o.push(s.data.pop())}function r(t){var r={data:[],done:!1};i.unshift(r),t.forEach(function(t){r.data.unshift(t),n()}),t.onClose(function(){r.done=!0,e()}),1===i.length&&(s=r)}var o=new t(this._name+".concatAll"),i=[],s=null;return this.forEach(function(t){r(t)}),this.onClose(function(){o.close()}),this._closed&&o.close(),o},t.prototype.combine=function(e){var n=this,r=new t(this._name+".combine");return this.forEach(function(t){r.push(t)}),e.forEach(function(t){r.push(t)}),this.onClose(function(){e.closed&&r.close()}),e.onClose(function(){n._closed&&r.close()}),this._closed&&e.closed&&r.close(),r},t.prototype.onClose=function(t){return this.addCloseMethod(t),this},t.prototype.onError=function(t){return this.addErrorMethod(t),this},t}();n.Stream=o,n.createStream=r},{}],10:[function(t,e,n){"use strict";function r(t){var e=t.getBoundingClientRect();return{x:e.left,y:e.top,w:e.width,h:e.height}}function o(t,e,n){for(var r=0;r<c.length;r++)c[r].camelCase||(e=e.toLowerCase()),t.addEventListener(c[r].id+e,n,!1)}function i(t){for(var e=[],n=0;n<arguments.length-1;n++)e[n]=arguments[n+1];
if(t){if("function"==typeof t){for(var r=[],o=1;o<arguments.length;o++)r.push(arguments[o]);return t.apply(this,r)}throw new Error("Callback is not a function!")}}function s(t,e){e.forEach(function(e){Object.getOwnPropertyNames(e.prototype).forEach(function(n){t.prototype[n]=e.prototype[n]})})}function a(t){return"[object Array]"===Object.prototype.toString.call(t)}function u(t){return t?(t.hasOwnProperty(h)||(t[h]=p++),t[h]):void 0}n.elementPositionAndSize=r;var c=[{id:"webkit",camelCase:!0},{id:"MS",camelCase:!0},{id:"o",camelCase:!0},{id:"",camelCase:!1}];n.addPrefixedEventListener=o,n.callCallback=i,n.applyMixins=s,n.isArray=a;var h="__ID__",p=1e4;n.oid=u},{}]},{},[1,2,3,4,5,6,7,8,9,10]);